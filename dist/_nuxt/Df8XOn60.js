import{d as H,r as a,C as A,o as X,g as q,t as d,H as J,A as g,z as V,x as s,y as k,S as K,T as l,U as v,W as U,v as c,Q as R,P as _,N as O,V as B,O as E,B as h,I as F,J as Q,K as W}from"./Lh55aVSo.js";import{_ as G}from"./inWKtfgP.js";import{a as x}from"./upsvKRUO.js";import{a as I}from"./C_D2JwHD.js";const Y={class:"flex justify-center items-center bg-[#f5f5f5] h-full pb-16"},Z={class:"flex flex-col justify-center items-center"},ee={class:"bg-white !rounded-3xl shadow-card w-[335px] md:w-auto md:min-w-96 p-6 mt-6 md:mt-12"},se={class:"text-sm opacity-80 mt-2"},te={class:"mb-3"},oe={class:"mb-3"},ae={class:"mb-3"},le={class:"mb-3"},re={class:"mb-3"},ne=["value"],ie={key:0,class:"mb-3"},de=["value"],ue={class:"mb-3 relative"},ce=["type"],pe={class:"mb-3 relative"},fe=["type"],me={class:"text-sm mt-3 mb-0 text-lead"},ke=H({__name:"signup-school-staff",setup(be){const w=a(""),p=a(""),f=a(""),m=a("");a(""),a([]);const u=a(""),b=a(""),n=a("password"),C=a([]),i=a(null),S=a([]),y=a([]);a([]);const T=A().query.ref||"",P=()=>{n.value=n.value==="password"?"text":"password"},M=async()=>(await x.get("https://www.snacks2school.com/api/csrf-token/",{withCredentials:!0})).data.csrfToken,N=a(0),z=async()=>{try{const o=await fetch("https://www.snacks2school.com/api/user-count/");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const e=await o.json();N.value=e.user_count}catch(o){console.error("Error fetching user count:",o)}},D=async()=>{try{const o=await x.get("https://www.snacks2school.com/api/provinces/");C.value=o.data}catch(o){console.error("Error fetching provinces:",o)}},L=async()=>{if(i.value)try{const o=await x.get(`https://www.snacks2school.com/api/province/schools/?province=${i.value}`);S.value=o.data}catch(o){console.error("Error fetching schools:",o)}},$=async()=>{try{const e=(await I.get("csrf-token/")).data.csrfToken,r=await I.post("login/",{username:p.value,password:u.value},{headers:{"X-CSRFToken":e},withCredentials:!0});r.data.token&&(localStorage.setItem("authToken",r.data.token),window.location.href="/")}catch(o){console.error("Login failed:",o)}},j=async()=>{try{if(u.value!==b.value){console.error("Passwords do not match");return}const o=await M(),e={email:w.value,username:p.value,student_first_name:f.value,student_last_name:m.value,first_name:f.value,last_name:m.value,location:i.value,associated_schools:y.value,password:u.value,confirm_password:b.value};let r="https://www.snacks2school.com/api/signup/school-staff/";T&&(r+=`?ref=${T}`);const t=await x.post(r,e,{headers:{"X-CSRFToken":o},withCredentials:!0});t.data.token?(document.cookie=`token=${t.data.token}`,await $()):console.error("No token received")}catch(o){console.error("Signup failed:",o)}};return X(()=>{z(),D()}),(o,e)=>{const r=q("router-link");return d(),J(F(W),null,{default:g(()=>[V(F(Q),{fullscreen:!0},{default:g(()=>[s("div",Y,[s("div",Z,[e[23]||(e[23]=s("img",{src:G,alt:"star",class:"h-32 w-32"},null,-1)),e[24]||(e[24]=s("div",{class:"text-4xl md:text-5xl font-bold"},"Snacks2School",-1)),e[25]||(e[25]=s("p",{class:"max-w-96 text-center !py-4"},"La merenda a portata di clic",-1)),s("div",ee,[e[21]||(e[21]=s("div",{class:"text-2xl font-semibold !text-black"},"Registrati",-1)),s("p",se," Unisciti ai "+k(N.value)+" utenti di Snacks2School ",1),e[22]||(e[22]=s("hr",{class:"mt-6 mb-4"},null,-1)),s("form",{class:"mb-3",onSubmit:K(j,["prevent"])},[s("div",te,[e[8]||(e[8]=s("label",{class:"block text-xs mb-1"},"Email *",-1)),l(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),id:"email",name:"email",type:"text",class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,512),[[v,w.value]])]),s("div",oe,[e[9]||(e[9]=s("label",{class:"block text-xs mb-1"},"Nome utente *",-1)),l(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),id:"username",name:"username",type:"text",class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,512),[[v,p.value]])]),s("div",ae,[e[10]||(e[10]=s("label",{class:"block text-xs mb-1"},"Nome *",-1)),l(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),id:"firstName",name:"firstName",type:"text",class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,512),[[v,f.value]])]),s("div",le,[e[11]||(e[11]=s("label",{class:"block text-xs mb-1"},"Cognome *",-1)),l(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),id:"lastName",name:"lastName",type:"text",class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,512),[[v,m.value]])]),s("div",re,[e[13]||(e[13]=s("label",{class:"block text-xs mb-1"},"Provincia della scuola *",-1)),l(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.value=t),id:"selectedProvince",name:"selectedProvince",class:"w-full bg-[#f5f5f5] border border-[1.5px] border-[#ffa500] !rounded !px-2 !py-1 cursor-pointer",style:{"border-radius":"5px",padding:"7px"},onChange:L},[e[12]||(e[12]=s("option",{value:"",disabled:""},null,-1)),(d(!0),c(_,null,R(C.value,t=>(d(),c("option",{key:t.id,value:t.id},k(t.name),9,ne))),128))],544),[[U,i.value]])]),i.value?(d(),c("div",ie,[e[14]||(e[14]=s("label",{class:"block text-xs mb-1"},"Scuola *",-1)),l(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),id:"associatedSchools",name:"associatedSchools",class:"w-full bg-[#f5f5f5] border border-[1.5px] border-[#ffa500] !rounded !px-2 !py-1 cursor-pointer",multiple:""},[(d(!0),c(_,null,R(S.value,t=>(d(),c("option",{key:t.id,value:t.id},k(t.name),9,de))),128))],512),[[U,y.value]])])):O("",!0),s("div",ue,[e[15]||(e[15]=s("label",{class:"block text-xs mb-1"},"Password *",-1)),l(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>u.value=t),id:"password",name:"password",type:n.value,class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,8,ce),[[B,u.value]]),s("i",{class:E([n.value==="password"?"fas fa-eye":"fas fa-eye-slash","absolute right-3 top-10 transform -translate-y-1/2 cursor-pointer"]),onClick:P},null,2)]),s("div",pe,[e[16]||(e[16]=s("label",{class:"block text-xs mb-1"},"Conferma password *",-1)),l(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>b.value=t),id:"confirmPassword",name:"confirmPassword",type:n.value,class:"w-full bg-[#f5f5f5] border border-[#e0e0e0]",style:{"border-radius":"5px",padding:"7px"}},null,8,fe),[[B,b.value]]),s("i",{class:E([n.value==="password"?"fas fa-eye":"fas fa-eye-slash","absolute right-3 top-10 transform -translate-y-1/2 cursor-pointer"]),onClick:P},null,2)]),e[19]||(e[19]=s("div",{class:"text-left"},[s("label",{class:"text-gray-[#888] text-xs",for:"flexCheckDefault"},[h(' Facendo clic su "Registrati" accetti i nostri '),s("a",{href:"",class:"iubenda-nostyle iubenda-noiframe iubenda-embed iubenda-noiframe underline !text-[#888]",title:"Termini e Condizioni"}," Termini e condizioni ")])],-1)),e[20]||(e[20]=s("div",{class:"text-center"},[s("button",{type:"submit",class:"btn bg-[#ffa500] w-full font-bold uppercase text-xs shadow-button my-4 mb-2 !py-3 !px-6 !rounded-lg"}," Registrati ")],-1)),s("p",me,[e[18]||(e[18]=h(" Hai giÃ  un account? ")),V(r,{to:"/login",class:"font-bold !text-black"},{default:g(()=>e[17]||(e[17]=[h("Accedi")])),_:1})])],32)])])])]),_:1})]),_:1})}}});export{ke as default};
